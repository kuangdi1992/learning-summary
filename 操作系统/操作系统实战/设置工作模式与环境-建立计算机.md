还是选择了先用老师建议的virtualbox来进行实验。

![image-20220828222711277](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828222711277.png)

### 生产虚拟硬盘

#### 生产虚拟硬盘

虚拟机只是用特定格式的文件来模拟硬盘，因此生产虚拟硬盘就变成了生成对应格式的文件。这里要建立100MB的硬盘，意味着要生成100MB的大文件。

linux下用dd命令生成100MB的纯二进制文件（1-100M字节的文件里面填充为0），如下所示：

```shell

dd bs=512 if=/dev/zero of=hd.img count=204800

;bs:表示块大小，这里是512字节
;if：表示输入文件，/dev/zero就是Linux下专门返回0数据的设备文件，读取它就返回0
;of：表示输出文件，即我们的硬盘文件。
;count：表示输出多少块
```

![image-20220828213815075](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828213815075.png)

执行上面的命令后，生成100MB的文件，文件数据为全0.

#### 格式化虚拟硬盘

虚拟硬盘格式化后才能使用，也就是在硬盘上建立文件系统。

只有建立了文件系统，现有的成熟操作系统才能在其中存放数据。

问题：虚拟硬盘是文件，如何让Linux在一个文件上建立文件系统呢？

##### 第一步

将虚拟硬盘文件变成Linux下的回环设备，让Linux以为这是个设备。

下面用losetup命令，将hd.img变成Linux的回环设备，代码如下：

```shell
sudo losetup /dev/loop0 hd.img
```

这里根据讲解的代码，出现如下问题：

![image-20220828214519241](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828214519241.png)

查看了df -h 之后，发现/dev/loop0已经被使用，如下：

![image-20220828214602357](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828214602357.png)

因此换了一个loop7，结果如下：

![image-20220828214628734](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828214628734.png)

##### 第二步

用linux下的mkfs.ext4命令格式化/dev/loop7回环块设备，在里面建立ext4文件系统。

```shell
sudo mkfs.ext4 -q /dev/loop7
```

![image-20220828214759485](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828214759485.png)

![image-20220828215100605](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828215100605.png)

![image-20220828215143789](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828215143789.png)

![image-20220828215407775](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220828215407775.png)





这里需要共享文件夹将hd.vdi文件共享到window中，然后创建新的HelloOS虚拟机，共享方法：

https://blog.csdn.net/hi_bigguy/article/details/79691309

![image-20220829232632358](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220829232632358.png)

在这里选择我们从Linux虚拟机中共享出来的hd.vdi文件。然后启动HelloOS。

![image-20220829230549177](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220829230549177.png)

![image-20220829230641011](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220829230641011.png)

出现这种情况，很明显是hd.img制作的有问题。



![image-20220829231930704](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20220829231930704.png)

到这里就成功了。