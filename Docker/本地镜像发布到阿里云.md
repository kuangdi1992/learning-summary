# 发布流程

![image-20230406222344849](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230406222344849.png)

# 推送步骤

第一步：做好本地镜像

```shell
[root@192 ~]# docker images
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
kd/myubuntu   1.1       dac744a2b764   4 seconds ago   183MB
ubuntu        latest    ba6acccedd29   17 months ago   72.8MB
redis         6.0.8     16ecd2772934   2 years ago     104MB
```

这里就使用之前创建的kd/myubuntu。

第二步：进入阿里云开发者平台。

地址：https://www.aliyun.com/

![image-20230406223234960](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230406223234960.png)

![image-20230406223208647](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230406223208647.png)

创建命名空间

![image-20230406223405956](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230406223405956.png)

创建镜像仓库

![image-20230406223723856](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230406223723856.png)

![image-20230406223520818](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230406223520818.png)

![image-20230406223555549](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230406223555549.png)

![image-20230406223650991](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230406223650991.png)

将镜像推送到阿里云registry

- docker login

  ```shell
  [root@192 ~]# docker login --username=17328314470 registry.cn-hangzhou.aliyuncs.com
  Password: 
  WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
  Configure a credential helper to remove this warning. See
  https://docs.docker.com/engine/reference/commandline/login/#credentials-store
  
  Login Succeeded
  ```

- docker tag

  ```shell
  [root@192 ~]# docker tag dac744a2b764 registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1:1.1
  ```

- docker push

  ```shell
  [root@192 ~]# docker push registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1:1.1
  The push refers to repository [registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1]
  42734647de38: Pushed 
  9f54eef41275: Pushed 
  1.1: digest: sha256:cae4cd8d86c1877b6adcd44fab1a4326238d4dd4ab56fffdbd11e7ee5f8f0f18 size: 741
  ```

将阿里云上的镜像下载到本地

```shell
[root@192 ~]# docker images
REPOSITORY                                                  TAG       IMAGE ID       CREATED          SIZE
kd/myubuntu                                                 1.1       dac744a2b764   36 minutes ago   183MB
registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1   1.1       dac744a2b764   36 minutes ago   183MB
ubuntu                                                      latest    ba6acccedd29   17 months ago    72.8MB
redis                                                       6.0.8     16ecd2772934   2 years ago      104MB
[root@192 ~]# docker rmi -f dac744a2b764
Untagged: kd/myubuntu:1.1
Untagged: registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1:1.1
Untagged: registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1@sha256:cae4cd8d86c1877b6adcd44fab1a4326238d4dd4ab56fffdbd11e7ee5f8f0f18
Deleted: sha256:dac744a2b764116c33700f4bd13853bed724ffbffdfb368fd60690f8b2ed9f79
[root@192 ~]# docker images
REPOSITORY   TAG       IMAGE ID       CREATED         SIZE
ubuntu       latest    ba6acccedd29   17 months ago   72.8MB
redis        6.0.8     16ecd2772934   2 years ago     104MB
[root@192 ~]# docker pull registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1:1.1
1.1: Pulling from kuangdi1992/myubuntu1.1
7b1a6ab2e44d: Already exists 
87b04711b41e: Already exists 
Digest: sha256:cae4cd8d86c1877b6adcd44fab1a4326238d4dd4ab56fffdbd11e7ee5f8f0f18
Status: Downloaded newer image for registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1:1.1
registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1:1.1
[root@192 ~]# docker images
REPOSITORY                                                  TAG       IMAGE ID       CREATED          SIZE
registry.cn-hangzhou.aliyuncs.com/kuangdi1992/myubuntu1.1   1.1       dac744a2b764   38 minutes ago   183MB
ubuntu                                                      latest    ba6acccedd29   17 months ago    72.8MB
redis                                                       6.0.8     16ecd2772934   2 years ago      104MB
```



# 问题

在登录阿里云Docker Registry时出现如下问题：

```shell
[root@192 ~]# docker login --username=17328314470 registry.cn-hangzhou.aliyuncs.com
Password: 
Error response from daemon: Get "https://registry.cn-hangzhou.aliyuncs.com/v2/": net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)
```

解决办法：

https://www.cnblogs.com/wangzy-Zj/p/16873237.html