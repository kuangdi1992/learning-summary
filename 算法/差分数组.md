# 差分数组

## 介绍

**差分数组的主要适用场景是频繁对原始数组的某个区间的元素进行增减**。

例如：输入一个数组sums，要求给区间nums[2……6]全部加1，再给nums[3……9]全部减去3，再给……，经过几次操作之后，最后nums数组的值是什么？

常规思路：按照题目的顺序进行处理，时间复杂度是O(N)，对nums的修改很频繁。

差分数组思路：

​		类似于前缀和的preSum数组一样，对nums数组构造一个diff差分数组，diff[i]是nums[i]和nums[i-1]之差。

```java
    int[] diff = new int[nums.length];
    diff[0] = nums[0];
    for(int i = 1; i < nums.length; i++){
        diff[i] = nums[i] - nums[i-1];
    }
```

这样构造差分数组diff，就可以快速进行区间增减的操作。

如果想对区间nums[i……j]的元素全部加3，那么只需要让diff[i] += 3，然后让diff[j+1] -= 3即可。

因为通过diff差分数组可以反推出原始数组nums，代码如下：

```java
int[] res = new int[diff.length];
// 根据差分数组构造结果数组
res[0] = diff[0];
for (int i = 1; i < diff.length; i++) {
res[i] = res[i - 1] + diff[i];
}
```

## 航班预定统计—leetcode1109

#### 题目

这里有 n 个航班，它们分别从 1 到 n 进行编号。

有一份航班预订表 bookings ，表中第 i 条预订记录 bookings[i] = [firsti, lasti, seatsi] 意味着在从 firsti 到 lasti （包含 firsti 和 lasti ）的 每个航班 上预订了 seatsi 个座位。

请你返回一个长度为 n 的数组 answer，里面的元素是每个航班预定的座位总数。

##### 示例

```java
输入：bookings = [[1,2,10],[2,3,20],[2,5,25]], n = 5
输出：[10,55,45,25,25]
解释：
航班编号        1   2   3   4   5
预订记录 1 ：   10  10
预订记录 2 ：       20  20
预订记录 3 ：       25  25  25  25
总座位数：      10  55  45  25  25
因此，answer = [10,55,45,25,25]
```

#### 分析

刚看到这个题目，感觉和差分数组没有太大关系，但是仔细分析后发现，题目可以翻译如下：

输⼊⼀个⻓度为 n 的数组 nums，其中所有元素都是 0，再输⼊⼀个 bookings，⾥⾯是若⼲三元组(i,j,k)，每个三元组的含义就是要求给 nums 数组的闭区间 [i-1,j-1] 中所有元素都加上 k。请返
回最后的 nums 数组是多少？  

翻译后，发现和差分数组的适用场景是一样的，所以可以使用差分数组来解决。

【注意】题目中是从1开始计数的，而数组的索引是从0开始的。对于输入的三元组（i,j,k）数组区间应该对应[i-1,j-1]。

#### 代码（差分数组标准类）

```java
package com.company.差分数组;

public class Difference {
    private int[] diff;

    public Difference(int[] nums){
        diff = new int[nums.length];
        diff[0] = nums[0];
        for(int i = 1; i < nums.length; i++){
            diff[i] = nums[i] - nums[i-1];
        }
    }

    public void increment(int i, int j, int val){
        diff[i] += val;
        if(j + 1 < diff.length){
            diff[j + 1] -= val;
        }
    }

    public int[] result(){
        int[] res = new int[diff.length];
        res[0] = diff[0];
        for(int i = 1; i < diff.length; i++){
            res[i] = res[i - 1] + diff[i];
        }
        return res;
    }
}
```

#### 代码（本题）

```java
public class leetcode1109 {
    public int[] corpFlightBookings(int[][] bookings, int n) {
        int[] nums = new int[n];
        Difference df = new Difference(nums);
        for(int[] booking : bookings){
            int i = booking[0] - 1;
            int j = booking[1] - 1;
            int val = booking[2];
            df.increment(i,j,val);
        }
        return df.result();
    }
}
```

#### 总结

注意差分数组的适用场景是频繁对某些区间的元素进行增减，可能会有变形。