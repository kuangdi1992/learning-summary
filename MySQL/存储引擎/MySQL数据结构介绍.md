# 介绍

从MySQL的角度来说，一个问题是磁盘IO。若能让索引的数据结构尽量减少磁盘的IO操作，所消耗的时间就越小。因此，磁盘的IO操作次数对索引的使用效率至关重要。

# Hash结构

Hash算法通过某种确定的算法（例如：MD5等）将输入变为输出。

加速查找速度的数据结构，常见的有两类：

1、树，例如平衡二叉搜索树，查询/插入/修改/删除的平均时间复杂度都是o(log2N)

2、哈希，例如HashMap，查询/插入/修改/删除的平均时间复杂度都是o(1)

![image-20230618223246453](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230618223246453.png)

采用Hash进行检索效率非常高，基本上一次检索就可以找到数据。

B+树需要自顶向下依次查找，多次访问节点才能找到数据，中间需要多次IO操作。

从效率来讲，Hash比B+树更快。

问题：Hash结构效率高，为什么索引结构要设计成树型？

答案：有3点原因：

- Hash索引仅仅能满足**=,<>,IN**查询，如果进行范围查询，哈希索引时间复杂度会退化成O(N)。
- Hash索引存储的数据没有顺序，在ORDER BY情况下，使用Hash索引需要对数据重新排列
- 对于联合索引，Hash值是将联合索引键合并后一起计算，没办法对单独一个键或几个索引键进行查询。
- 对于等值查询，Hash索引的效率更高，不过存在一种情况，就是**索引列的重复值如果很多，效率就会降低**。主要是Hash冲突。

**Hash索引使用存储引擎如表**

| 索引/存储引擎 | MyISAM | InnoDB | Memory |
| ------------- | ------ | ------ | ------ |
| Hash索引      | 不支持 | 不支持 | 支持   |

## Hash索引适用性

Hash索引存在很多限制，相比之下在数据库中B+树索引的使用面会更广，不过也有一些场景采用Hash索引效率更高，比如在键值型数据库中，Redis存储的核心是Hash表。

InnoDB本身不支持Hash索引，但是提供**自适应Hash索引**。什么情况下回使用自适应Hash索引呢？如果某个数据经常被访问，当满足一定条件的时候，就将这个数据页的地址存放到Hash表中，这样下次查询的时候，可以直接找到这个页面所在的位置。示例如下：

![image-20230618224608651](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230618224608651.png)

采用自适应Hash索引的目的是方便根据SQL的查询条件加速定位到叶子节点，特别是当B+树比较深的时候，通过自适应Hash索引可以明显提高数据的检索效率。

**查看是否开启了自适应Hash索引**

```sql
mysql> show variables like '%adaptive_hash_index';
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| innodb_adaptive_hash_index | ON    |
+----------------------------+-------+
1 row in set, 1 warning (0.08 sec)
```

# 二叉搜索树

利用二叉树作为索引结构，那么磁盘的IO次数和索引树的高度是相关的。

## 二叉搜索树的特点

- 一个节点只能有两个子节点，也就是一个节点度不能超过2
- 左子节点小于等于本节点，右子节点大于等于本节点。

## 查找规则

假设搜索插入的数值为key：

- 如果key大于根节点，则在右子树中进行查找
- 如果key小于根节点，则在左子树中进行查找
- 如果key等于根节点，也就是找到了这个节点，返回根节点即可

数列(34、22、89、5、23、77、91)的二分查找树：

![image-20230618225454745](C:\Users\kd\AppData\Roaming\Typora\typora-user-images\image-20230618225454745.png)

AVL树

也叫**平衡二叉搜索树**

特性：**一棵空树或者它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。**

常见的平衡二叉树有很多，例如：平衡二叉搜索树，红黑树，数堆等。



