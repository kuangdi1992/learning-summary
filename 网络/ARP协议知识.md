## ARP协议
ARP协议是地址解析协议的缩写。
### ARP协议的作用
在以太网环境中，数据的传输所依懒的是MAC地址而非IP地址，而==将已知IP地址转换为MAC地址的工作是由ARP协议来完成的==，也就是说==ARP协议为IP地址到对应的硬件地址提供动态映射。==

 在局域网中，网络中实际传输的是“帧”，帧里面是有目标主机的MAC地址的。在以太网中，一个主机和另一个主机进行直接通信，必须要知道目标主机的MAC地址。但这个目标MAC地址是如何获得的呢？它就是通过地址解析协议获得的。所谓“地址解析”就是主机在发送帧前将目标IP地址转换成目标MAC地址的过程。ARP协议的基本功能就是通过目标设备的IP地址，查询目标设备的MAC地址，以保证通信的顺利进行。
 
 ### ARP协议的例子
 当我们进行ftp传输文件的时候，我们会输入下面形式的命令：
``` javascript
ftp bsdi
```
那么在我们输入这个命令之后，会进行如下的步骤：

 1. 应用程序FTP客户端调用函数将主机名bsdi转换成32bit的IP地址。
 2. FTP客户端请求TCP用得到的IP地址来建立连接。
 3. TCP会发送一个连接请求分段到远端主机（用上述的IP地址发送一份IP数据报）
 4. 如果目的主机在本地网络，那么IP数据报会直接发送到目的主机上。如果目的主机在一个远程网络上，则通过IP选路来确定本地网络的下一跳路由地址，并转发IP数据报。
 5. 假定是一个以太网，那么发送端主机要将32bit的IP地址变成48bit的以太网地址（==从IP地址到对应物理硬件地址需要进行翻译——ARP的功能#F44336 #F44336==）。
 6. ARP发送一份ARP请求报文给以太网上的每一台主机（广播）。ARP请求报文中包含目的主机的IP地址（主机名为bsdi），其意思是“如果你是这个IP的拥有者，则回答你的硬件地址。”
 7. 目的主机的ARP层收到这份广播报文后，会发送一个ARP应答报文，包含IP地址和对应的硬件地址。
 8. 收到ARP应答报文后，可以发送IP数据报到目的主机。

![enter description here](https://github.com/kuangdi1992/Interview-knowledge/blob/master/%E7%BD%91%E7%BB%9C%E9%9D%A2%E8%AF%95/%E5%9B%BE%E7%89%87/ARP1.png)

从上面的ftp的过程中，我们可以了解到ARP的作用。

### ARP原理以及流程
#### ARP原理
在任何时候，一台主机有IP数据报文发送给另一台主机，它都要知道接收方的逻辑（IP）地址。但是==IP地址必须封装成帧才能通过物理网络。 #F44336==这就意味着发送方必须有接收方的物理（MAC）地址，因此需要完成逻辑地址到物理地址的映射。而==ARP协议可以接收来自IP协议的逻辑地址，将其映射为相应的物理地址，然后把物理地址递交给数据链路层==。

#### ARP请求
任何时候，当主机需要找出这个网络中的另一个主机的物理地址时，它就可以发送一个ARP请求报文，这个报文包好了发送方的MAC地址和IP地址以及接收方的IP地址。因为发送方不知道接收方的物理地址，所以这个查询分组会在网络层中进行==广播 #F44336==。
![enter description here](https://github.com/kuangdi1992/Interview-knowledge/blob/master/%E7%BD%91%E7%BB%9C%E9%9D%A2%E8%AF%95/%E5%9B%BE%E7%89%87/ARP%E8%AF%B7%E6%B1%82.png)
#### ARP响应
==局域网中的每一台主机都会接受并处理这个ARP请求报文，然后进行验证，查看接收方的IP地址是不是自己的地址，只有验证成功的主机才会返回一个ARP响应报文，这个响应报文包含接收方的IP地址和物理地址。== 这个报文利用收到的ARP请求报文中的请求方物理地址以单播的方式直接发送给ARP请求报文的请求方。
![enter description here](https://github.com/kuangdi1992/Interview-knowledge/blob/master/%E7%BD%91%E7%BB%9C%E9%9D%A2%E8%AF%95/%E5%9B%BE%E7%89%87/ARP%E5%93%8D%E5%BA%94.png)

#### ARP协议报文
ARP报文是28字节，如下：


 - 硬件类型：16位字段，用来定义运行ARP的网络类型。每个局域网基于其类型被指派一个整数。例如：以太网的类型为1。ARP可用在任何物理网络上。
 - 协议类型：16位字段，用来定义使用的协议。例如：对IPv4协议这个字段是0800。ARP可用于任何高层协议
 - 硬件长度：8位字段，用来定义物理地址的长度，以字节为单位。例如：对于以太网的值为6。
 - 协议长度：8位字段，用来定义逻辑地址的长度，以字节为单位。例如：对于IPv4协议的值为4。
 - 操作码：16位字段，用来定义报文的类型。已定义的分组类型有两种：ARP请求（1），ARP响应（2）。
 - 源硬件地址：这是一个可变长度字段，用来定义发送方的物理地址。例如：对于以太网这个字段的长度是6字节。
 - 源逻辑地址：这是一个可变长度字段，用来定义发送方的逻辑（IP）地址。例如：对于IP协议这个字段的长度是4字节。
 - 目的硬件地址：这是一个可变长度字段，用来定义目标的物理地址，例如，对以太网来说这个字段位6字节。对于ARP请求报文，这个字段为全0，因为发送方并不知道目标的硬件地址。
 - 目的逻辑地址：这是一个可变长度字段，用来定义目标的逻辑（IP）地址，对于IPv4协议这个字段的长度为4个字节。



