计算机网络
第一章  概述
互联网的组成以及几种网络传输方式
边缘部分：由所有连接在互联网上的主机构成。这部分是用户直接使用的，用来通讯和数据共享。
计算机之间的通讯有两种：一种是客户服务器方式，一种是P2P方式
核心部分：由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务。
核心中起重要作用的是路由器，他的作用是分组交换，转发收到的分组。


数据交换的几种方式和特点：
1.电路交换：需要进行建立连接、通话、释放连接三个过程。资源独占，线路传输的效率较低。（整个报文的比特流连续地从源点直达终点）
2.分组交换：需要将数据报切分为较小的等长数据块，加入必要的控制信息，构成每一个分组，每一个分组独立传输。
分组交换高效，灵活，迅速，可靠，但是也带来了时延和不必要的开销。
3.报文交换：整个报文传递到临近节点，全部存储下来后再查找转发表，转发到下一个节点。

分层：
TCP/IP通常被认为是一个四层协议系统。
应用层（各种应用层协议）：负责处理特定的应用程序细节。主要应用有:Telnet、FTP、SMTP、SNMP。
运输层（TCP或UDP）：为两台主机上的应用程序提供端到端的通信，主要有两个协议TCP/UDP：TCP为两台主机提供高可靠性的数据通信，UDP为应用层提供一种非常简单的服务，传输不可靠。
网际层IP：处理和分组相关，协议主要包括IP协议（网际协议）、ICMP协议（控制报文协议）、IGMP协议（组管理协议）。
网络接口层

OSI体系结构：
应用层：允许访问OSI环境的手段（应用协议数据单元APDU）（FTP、DNS、Telnet、SMTP）（网关）
表示层：对数据进行翻译、加密和压缩（协议数据单元PPDU）（网关）
会话层：建立、管理和终止会话（协议数据单元SPDU）（网关）
运输层：提供端到端的可靠报文传递和错误回复（段）（TCP、UDP）
网络层：负责数据包从源到宿的传递和网际互连（包，分组，数据报）（路由器）（IP、ICMP、ARP、RARP、OSPF）
数据链路层：将比特组装成帧和点到点的传递（帧）（网桥、交换机）（PPP、HDLC、VLAN）
物理层：通过媒介传输比特，确定机械及电气规范（比特）（中继器、集线器）（IEEE802.3）

五层协议体系结构：
应用层
运输层
网络层
数据链路层
物理层

第二章   数据链路层
主要功能：把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据取出来并上交给网络层。
数据链路层使用的信道主要有两种类型：1.点对点信道 2.广播信道
数据链路层有三个基本问题：1.封装成帧 2.透明传输 3.差错检测

封装成帧：
在数据的前后添加尾部和首部，这样就构成了一个帧
帧界定符：SOH表示一个帧的开始，EOT表示帧的结束
发送端以比特位方式一位位地传输到接收端的物理层，然后接收端的物理层把比特流向数据链路层传输，到达后又要将比特流封装成数据帧，这就是数据链路层的帧组装方式了，其实也就是我们前面提到的帧同步问题。
帧同步的目的就是要使接收端的数据链路层对从物理层传输而来的一串串比特流以帧为单位进行区分。

透明传输：
能传输任何的数据，在帧定界中用到的标记帧起点和结束的字符也应该能正确的被传输。
发送端的数据链路层在数据中出现控制字符SOH和EOT时候，需要在前面插入一个转义字符ESC，这种方式称之为字节填充或字符填充。
1.零比特填充 
PPP 协议用在 SONET/SDH 链路时，是使用同步传输（一连串的比特连续传送）。这时 PPP 协议采用零比特填充方法来实现透明传输。
在发送端，只要发现有 5 个连续 1，则立即填入一个 0。接收端对帧中的比特流进行扫描。每当发现 5 个连续1时，就把这 5 个连续 1 后的一个 0 删除，

差错检验：
在传输过程中可能会产生比特差错：1可能会变成0，0也可能变成1
在一段时间内，传输错误的比特占所传输比特总数的比率——误码率BER。
误码率与信噪比有很大的关系。

循环冗余检验（CRC）：
1.在发送端，先把数据划分为组。假定每组 k 个比特。
2.假设待传送的一组数据 M = 101001（现在 k = 6）。我们在 M 的后面再添加供差错检测用的 n 位冗余码一起发送。
3.用二进制的模 2 运算进行 2n 乘 M 的运算，这相当于在 M 后面添加 n 个 0。
4.得到的 (k + n) 位的数除以事先选定好的长度为 (n + 1) 位的除数 P，得出商是 Q 而余数是 R，余数 R 比除数 P 少1 位，即 R 是 n 位

仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受(accept)。

PPP协议：
使用得最多的数据链路层协议是点对点协议 PPP (Point-to-Point Protocol)。用户使用拨号电话线接入因特网时，一般都是使用 PPP 协议。
1.三个组成部分：
一个将 IP 数据报封装到串行链路的方法。
链路控制协议 LCP (Link Control Protocol)。
网络控制协议 NCP (Network Control Protocol)。
2.PPP协议的帧格式
标志字段 F = 0x7E （符号“0x”表示后面的字符是用十六进制表示。十六进制的 7E 的二进制表示是 01111110）。
地址字段 A 只置为 0xFF。地址字段实际上并不起作用。
控制字段 C 通常置为 0x03。
PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。 

CSMA/CD 协议 （载波监听多点接入/碰撞检测 ）
1.载波监听多点接入
“多点接入”表示许多计算机以多点接入的方式连接在一根总线上。
“载波监听”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。
2.碰撞检测（冲突检测）
2.1.“碰撞检测”就是计算机边发送数据边检测信道上的信号电压大小。 
当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）。
当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。
所谓“碰撞”就是发生了冲突。因此“碰撞检测”也称为“冲突检测”。
2.2.检测到碰撞之后： 
在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来。
每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后等待一段随机时间后再次发送。

第三章  网络层
IP层提供不可靠、无连接的服务，不可靠指的是不能保证IP数据包能够成功到达目的地，无连接表示IP数据报并不维护任何关于后续数据报的状态信息。
虚电路服务：可靠通信应当由网络来保证，必须建立连接，属于同一条虚电路的分组均按照同一路由进行转发，所有通过出故障的结点的虚电路均不能工作，总是按发送顺序到达终点。
数据报服务：可靠通信应当由用户主机来保证，不需要建立连接，每个分组都有终点完整地址，每个分组独立选择路由进行转发，出故障的结点可能会丢失分组，一些路由可能发生变化，到达终点的时间不一定按发送顺序。

ARP地址解析协议
（1）首先，每个主机都会在自己的ARP缓冲区中建立一个ARP列表，以表示IP地址和MAC地址之间的对应关系。
（2）当源主机要发送数据时，首先检查ARP列表中是否有对应IP地址的目的主机的MAC地址，如果有，则直接发送数据，如果没有，就向本网段的所有主机发送ARP数据包，该数据包包括的内容有：源主机IP地址，源主机MAC地址，目的主机的IP地址。
（3）当本网络的所有主机收到该ARP数据包时，首先检查数据包中的IP地址是否是自己的IP地址，如果不是，则忽略该数据包，如果是，则首先从数据包中取出源主机的IP和MAC地址写入到ARP列表中，如果已经存在，则覆盖，然后将自己的MAC地址写入ARP响应包中，告诉源主机自己是它想要找的MAC地址。
（4）源主机收到ARP响应包后。将目的主机的IP和MAC地址写入ARP列表，并利用此信息发送数据。如果源主机一直没有收到ARP响应数据包，表示ARP查询失败。
广播发送ARP请求，单播发送ARP响应。







